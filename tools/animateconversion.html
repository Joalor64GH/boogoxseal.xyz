<!DOCTYPE html>
<html lang="en" style="background-color:rgb(17, 5, 29) ;">
<head>
	<title>Adobe Animate to Incredibox Converter - BOOGO x SEAL</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Boogo and Seal make Incredibox Mods and Tools.">
	<link rel="apple-touch-icon" sizes="180x180" href="../icons/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="../icons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="../icons/favicon-16x16.png">
	<link rel="manifest" href="../icons/site.webmanifest">
	<link rel="shortcut icon" href="../icons/favicon.ico">
	<meta name="msapplication-TileColor" content="#603cba">
	<meta name="msapplication-config" content="../icons/browserconfig.xml">
	<meta name="theme-color" content="#ffffff">
	<meta charset="UTF-8">
	<meta property="og:type" content="website">
	<meta property="og:site_name" content="BOOGO x SEAL">
	<meta property="og:title" content="Adobe Animate to Incredibox Converter" />
	    <meta property="og:image" content="https://boogoxseal.xyz/assets/banner.png" />
    <meta property="twitter:image:src" content="https://boogoxseal.xyz/assets/banner.png" />
	<meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="Boogo and Seal make Incredibox Mods and Tools.">
    <meta name="og:image:alt" content="Boogo and Seal make Incredibox Mods and Tools.">
    <meta name="og:description" content="Boogo and Seal make Incredibox Mods and Tools.">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.1/mdb.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/topnav.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" integrity="sha512-XMVd28F1oH/O71fzwBnV7HucLxVwtxf26XV8P4wPk26EDxuGZ91N8bsOttmnomcCD3CS5ZMRL50H0GgOHvegtg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        td{text-align:center}.th-custom{overflow:auto;font-weight:200;text-align:center;padding-left:5px;padding-right:5px;font-size:28px;margin:10px}body{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;color:#fff;overflow:auto;font-family:monospace;font-weight:500;margin-top:15vh}
    </style>
</head>



<body style="background-color:rgb(17, 5, 29) ;">
    <div class="topnav">
		<a href="../">Home</a>
		<a class="active" href="./">Tools</a>
		<a href="../mods">Mods</a>
		<a href="../about">About Us</a>
	  </div>
	<div class="container mt-3" style="background-color:rgb(29, 8, 49) ; overflow:hidden;	padding-bottom:40px;height:100%;" >
		<h1 class="m-4 mt-3">Adobe Animate to Incredibox Converter</h1>
        <div id="form">
            <h3 class="m-3">Options</h3>
            <div class="form-group col-md-5 m-4">
                <label for="spritesheet">Spritesheet</label>
                <input class="form-control" type="file" id="spritesheet" required="true"></input>
            </div>
            <div class="form-group col-md-5 m-4">
                <label for="spritesheetq">Is the spritesheet in HD or Non-HD Format?</label>
                <select id="spritesheetq" class="form-control" required="true">
                    <optgroup>
                        <option value="hd">HD</option>
                        <option value="non-hd" selected="">Non-HD</option>
                    </optgroup>
                </select>
            </div>
            <div class="form-group col-md-5 m-4">
                <label for="json">JSON</label>
                <input class="form-control" type="file" id="json" required="true"></input>
            </div>
            <div class="form-group col-md-5 m-4">
                <label for="jsonq">Is the JSON in HD or Non-HD Format?</label>
                <select id="jsonq" class="form-control" required="true">
                    <optgroup>
                        <option value="hd">HD</option>
                        <option value="non-hd" selected="">Non-HD</option>
                    </optgroup>
                </select>
            </div>
            <div class="form-group m-4 mt-4" id="submit">
                <input class="btn btn-primary" type="submit" value="Submit" id="submission"></input>
            </div>
            <br>
            <hr class="hr hr-blurry" />
            <br>
            <div class="m-4">
                <h3>How to export to Spritesheet and JSON from Adobe Animate?</h3>
                <span>
                    1. After you've finished your symbol, right click on it and select the 'Generate Sprite Sheet...' button.<br><br>
                    2. A menu will appear, the follow settings should be set:<br>
                        - Image Dimensions: Auto size<br>
                        - Image format: PNG 32 bit<br>
                        - Background Color: Transparent<br>
                        - Algorithm: Basic<br>
                        - Data format: JSON<br>
                        - Rotate: Disabled<br>
                        - Trim: Disabled<br>
                        - Stack frames: Enabled<br>
                        - Border padding: 0px<br>
                        - Shape padding: 0px<br><br>
                    3. Press 'Export' ion the bottom right corner of the menu, a PNG and a JSON should be outputted to the output directory. <br>These are the files that should be used
                </span>
            </div>
            <canvas id="spritesheetcanvas" class="visually-hidden"></canvas>
            <canvas id="fixedspritesheetcanvas" class="visually-hidden"></canvas>
            <div id="jsoncontent" class="visually-hidden"></div>
            <div id="spritesheetcontent" class="visually-hidden"></div>
        </div>
	</div>
    <script>
        seperate_count=0
        function download(uri, name) {
            var link = document.createElement("a");
            link.download = name;
            link.href = uri;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            delete link;
        }
        function range(start, stop, step) {
            if (typeof stop == 'undefined') {
                // one param defined
                stop = start;
                start = 0;
            }

            if (typeof step == 'undefined') {
                step = 1;
            }

            if ((step > 0 && start >= stop) || (step < 0 && start <= stop)) {
                return [];
            }

            var result = [];
            for (var i = start; step > 0 ? i < stop : i > stop; i += step) {
                result.push(i);
            }

            return result;
        };

        function submit() {
            if ( ! window.FileReader ) {
                return alert( 'FileReader API is not supported by your browser.' );
            }
            jsondata=""
            
            pngdata=""
            $( '#jsoncontent' ).empty()
            $( '#spritesheetcontent' ).empty()
            var $i = $( '#json' ), // Put file input ID here
                inputi = $i[0]; // Getting the element from jQuery
            var $j = $( '#spritesheet' ), // Put file input ID here
                inputj = $j[0]; // Getting the element from jQuery
            
            if ( inputi.files && inputi.files[0] ) {
                file = inputi.files[0]; // The file
                fr = new FileReader(); // FileReader instance
                fr.onload = function () {
                    // Do stuff on onload, use fr.result for contents of file
                    jsondata = JSON.parse(atob(fr.result.split(',')[1].split('/')[1]))
                    
                };
                //fr.readAsText( file );
                fr.readAsDataURL( file );
            } else {
                // Handle errors here
                alert( "JSON not selected" )
            }
            if ( inputj.files && inputj.files[0] ) {
                filej = inputj.files[0]; // The file
                frj = new FileReader(); // FileReader instance
                frj.onload = function () {
                    // Do stuff on onload, use fr.result for contents of file
                    frame0width = jsondata.frames[Object.keys(jsondata.frames)[0]].sourceSize.w
                    frame0height = jsondata.frames[Object.keys(jsondata.frames)[0]].sourceSize.h
                    canvas=$('#spritesheetcanvas')[0]
                    ctx= canvas.getContext('2d')
                    var img = new Image;
                    
                    img.onload = function(){
                    ctx.canvas.width = this.width
                    ctx.canvas.height = this.height
                    ctx.drawImage(this,0,0); // Or at whatever offset you like
                    };
                    img.src = frj.result;
                    if ($('#spritesheetq').find(':selected').val() === "non-hd" && $('#jsonq').find(':selected').val() === "hd") {
                        frame0width=frame0width/2, frame0height=frame0height/2;
                    }
                    if ($('#spritesheetq').find(':selected').val() === "hd" && $('#jsonq').find(':selected').val() === "non-hd") {
                        frame0width=frame0width*2, frame0height=frame0height*2;
                    }
                    newframes=[]
                    headcoords=[]
                    heads=[]
                    prev=[]
                    headcount=0
                    for (i in Object.keys(jsondata.frames)) {
                        frame=jsondata.frames[Object.keys(jsondata.frames)[i]].frame
                        if (!prev.includes(JSON.stringify(frame))) {
                            headcount++
                            prev.push(JSON.stringify(frame))
                            temphead = canvas.getContext('2d').getImageData(frame.x,frame.y,frame0width,frame0height)
                            headcoords.push({"x":frame.x,"y":frame.y})
                            heads.push(temphead)
                        }
                        newframes.push({"prop":`${frame.x},${frame.y},0,0`})
                    }
                    console.log(headcount)

                    count=0
                    newcanvas=$('#fixedspritesheetcanvas')[0]
                    newctx = newcanvas.getContext('2d')
                    newctx.canvas.width = frame0width*5
                    newctx.canvas.height = frame0height*(Math.ceil(headcount/5)+1)
                    currentx=0
                    currenty=frame0height
                    modified_indexes=[]
                    for (i in range(headcount)) {
                        console.log(currentx,currenty)
                        i=Number(i)
                        count++
                        x = headcoords[i].x
                        y = headcoords[i].y
                        temphead = heads[i]
                        newcanvas.getContext('2d').putImageData(temphead,currentx,currenty)
                        fc = 0
                        for (f in newframes) {
                            f=newframes[f]
                            if (f.prop == `${x},${y},0,0` && !modified_indexes.includes(fc)) {
                                modified_indexes.push(fc)
                                newframes[fc].prop = `${currentx},${currenty},0,0`
                            }
                            fc++
                        }
                        if (count%5 === 0) {
                            currenty=currenty+frame0height
                            currentx=0
                        } else {
                            currentx=currentx+frame0width
                        }
                    }
                    newjsondata={"animeName":"generated-from-fla-using-sealldevelopers-tools","percentageMax":"0.2","totalFrame":`${newframes.length}`,"width":`${frame0width}`,"height":`${frame0height}`,"headHeight":`${frame0height}`,"arrayFrame":newframes}
                    var zip = new JSZip();
                    zip.file(`generated.json`,JSON.stringify(newjsondata))
                    var datauri = newcanvas.toDataURL('image/png')
                    var data = datauri.replace(/^data:image\/\w+;base64,/, "");
                    zip.file(`generated-sprite.png`, data, {base64:true})
                    zip.generateAsync({type:"base64"}).then(function (base64) {
                        window.open("data:application/zip;base64," + base64);
                    });
                };
                //fr.readAsText( file );
                frj.readAsDataURL( filej );
            } else {
                // Handle errors here
                alert( "Spritesheet not selected" )
            }
        }

        $('#submission').on('click', function(){
            seperate_count++
            if (seperate_count == 1){
                submit()
                alert('If your sprite-sheet fails, please re-submit. This is an ongoing issue...')
            } else {
                submit()
            }
                
        })
    </script>
    <h3 style="padding-bottom:5px"></h3>
    <h3 style="text-align:center;font-size:10px">Made by <a style="font-size:10px"target="_blank" rel="noopener noreferrer" class="enter">seal</a></h3>
</body>
</html>
